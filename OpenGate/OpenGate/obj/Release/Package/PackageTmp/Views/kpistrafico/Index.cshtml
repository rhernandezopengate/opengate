
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_LayoutKpis.cshtml";
}

<div class="row">
    <div class="col-md-12 col-sm-12 col-xs-12">
        <div class="x_panel">
            <div class="x_title">
                <h2> KPIS Tr&aacute;fico <small>Index</small></h2> &nbsp;&nbsp;&nbsp;
                @if (User.IsInRole("gerentegeneral") || User.IsInRole("trafico") || User.IsInRole("admin"))
                {
                    <a class="btn btn-success" href="@Url.Action("Create")"> <i class="glyphicon glyphicon-plus-sign"></i> Agregar Registros</a>
                    <a class="btn btn-danger" href="@Url.Action("Delete")"> <i class="glyphicon glyphicon-remove-sign"></i> Eliminar Registros</a>
                }
                <div class="clearfix"></div>
            </div>
            <div class="x_content">
                <div class="well" style="overflow: auto">
                    <div class="col-md-3 col-sm-6 col-xs-12 form-group has-feedback">
                        <input type="text" class="form-control has-feedback-left" id="remision" name="remision" placeholder="Remisión">
                        <span class="fa fa-list-alt form-control-feedback left" aria-hidden="true"></span>
                    </div>

                    <div class="col-md-3 col-sm-6 col-xs-12 form-group has-feedback">
                        <input type="text" class="form-control has-feedback-left" id="destino" name="destino" placeholder="Destino">
                        <span class="fa fa-road form-control-feedback left" aria-hidden="true"></span>
                    </div>

                    <div class="col-md-3 col-sm-6 col-xs-12 form-group has-feedback">                        
                        <select class="form-control  has-feedback-left" id="ddlTipoRequerimiento"></select>
                        <span class="fa fa-filter form-control-feedback left" aria-hidden="true"></span>
                    </div>
                    
                </div>
            </div>
            <table id="tblsKpisTrafico" class="table table-bordered nowrap" width="100%">
                <thead>
                    <tr>
                        <th>
                            Id
                        </th>
                        <th>
                            Remisi&oacute;n
                        </th>
                        <th>
                            Consecutivo Flete
                        </th>
                        <th>
                            Responsable
                        </th>
                        <th>
                            Mes
                        </th>
                        <th>
                            Origen
                        </th>
                        <th>
                            Destino
                        </th>
                        <th>
                            WH
                        </th>
                        <th>
                            Ruta
                        </th>
                        <th>
                            Tipo Requerimiento
                        </th>
                        <th>
                            WK
                        </th>
                        <th>
                            Fecha Carga
                        </th>
                        <th>
                            Fecha Entrega
                        </th>
                        <th>
                            RO
                        </th>
                        <th>
                            Tipo Env&iacute;o
                        </th>
                        <th>
                            Tipo Unidad
                        </th>
                        <th>
                            Capacidad Pallets Unidad
                        </th>
                        <th>
                            Pallets Embarcados
                        </th>
                        <th>
                            % Ocupaci&oacute;n Unidad
                        </th>
                        <th>
                            Capacidad Unidad
                        </th>
                        <th>
                            Peso Inventario
                        </th>
                        <th>
                            % Peso Unidad
                        </th>
                        <th>
                            Evaluacion Ocupacion Unidad
                        </th>
                        <th>
                            Numero Cajas
                        </th>
                        <th>
                            Numero Piezas
                        </th>
                        <th>
                            Fecha/Hora Requerida Posicionamiento
                        </th>
                        <th>
                            Fecha/Hora Real Posicionamiento
                        </th>
                        <th>
                            Evaluacion Posicionamiento
                        </th>
                        <th>
                            Fecha/Hora Cita
                        </th>
                        <th>
                            Fecha/Hora Arribo Real
                        </th>
                        <th>
                            Evaluacion Entrega
                        </th>
                        <th>
                            Maniobristas Requeridos
                        </th>
                        <th>
                            Maniobristas a Tiempo
                        </th>
                        <th>
                            Evaluaci&oacute;n Maniobras
                        </th>
                        <th>
                            Facturaci&oacute;n Flete
                        </th>
                        <th>
                            Facturaci&oacute;n Maniobras
                        </th>
                        <th>
                            Observaciones
                        </th>
                    </tr>
                </thead>
            </table>
        </div>
    </div>
</div>

<!-- CSS Datatable -->
<link href="~/vendors/datatables.net-bs/css/dataTables.bootstrap.min.css" rel="stylesheet" />
<link href="https://cdn.datatables.net/buttons/1.5.2/css/buttons.dataTables.min.css" rel="stylesheet" />
<link href="https://cdn.datatables.net/responsive/2.2.3/css/responsive.bootstrap.min.css" rel="stylesheet" />

<!-- JQuery Datatable -->
<script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap.min.js"></script>
<script src="https://cdn.datatables.net/responsive/2.2.3/js/dataTables.responsive.min.js"></script>
<script src="https://cdn.datatables.net/responsive/2.2.3/js/responsive.bootstrap.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.5.4/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.4.0/js/buttons.flash.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script src="https://cdn.rawgit.com/bpampuch/pdfmake/0.1.27/build/pdfmake.min.js"></script>
<script src="https://cdn.rawgit.com/bpampuch/pdfmake/0.1.27/build/vfs_fonts.js"></script>
<script src="https://cdn.datatables.net/buttons/1.4.0/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.4.0/js/buttons.print.min.js"></script>
<script src="~/vendors/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>

<!-- Custom Theme Scripts -->
<script src="~/build/js/custom.min.js"></script>

<!-- JQuery UI -->
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

<script type="text/javascript">

    $(document).ready(function () {

        table = $('#tblsKpisTrafico').DataTable({
            "order": [[0, "desc"]],
            "ordering": true,
            "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
            "pagingType": "simple_numbers",
            "dom": 'Blrtip', // Hides Default Search
            "responsive": true,
            "processing": true,
            "serverSide": true,
            "orderMulti": false,
            "deferRender": true,
            rowId: 'id',
            select: true,
            "ajax": {
                "url": "/kpistrafico/ListaKpis",
                "type": "POST",
                "datatype": "json"
            },
            buttons: [

                {
                    extend: 'copyHtml5',
                    text: '<i class="fa fa-files-o"></i>',
                    titleAttr: 'COPIAR',
                    exportOptions: {
                        columns: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36]
                    }
                },                
                {
                    extend: 'excel',
                    text: '<i class="fa fa-file-excel-o"></i>',
                    titleAttr: 'EXCEL',
                    exportOptions: {
                        columns: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36]
                    }
                }                
            ],
            "aoColumns": [
                //0
                { "data": "id", "autoWidth": true, "visible": false },
                { "data": "remision", "autoWidth": true },
                { "data": "consecutivoflete", "autoWidth": true },
                { "data": "respnsableflete", "autoWidth": true },
                { "data": "mescarga", "autoWidth": true },
                { "data": "origen", "autoWidth": true },
                { "data": "destino", "autoWidth": true },
                { "data": "wh", "autoWidth": true },
                { "data": "ruta", "autoWidth": true },
                { "data": "tiporequerimiento", "autoWidth": true },
                { "data": "wk", "autoWidth": true },
                {
                    "data": "fechacarga",
                    "name": "fechacarga",
                    "render": function (data, type, full) {

                        var data1 = data.replace("/Date(", "").replace(")/", "");
                        var date = new Date(parseInt(data1));
                        var month = date.getMonth() + 1;
                        return date.getDate() + "-" + (month.toString().length > 1 ? month : "0" + month) + "-" + date.getFullYear();
                    },
                    "autoWidth": true
                },
                {
                    "data": "fechaentrega",
                    "name": "fechaentrega",
                    "render": function (data, type, full) {

                        var data1 = data.replace("/Date(", "").replace(")/", "");
                        var date = new Date(parseInt(data1));
                        var month = date.getMonth() + 1;
                        return date.getDate() + "-" + (month.toString().length > 1 ? month : "0" + month) + "-" + date.getFullYear();
                    },
                    "autoWidth": true
                },
                { "data": "ro", "autoWidth": true },
                { "data": "tipoenvio", "autoWidth": true },
                { "data": "tipounidad", "autoWidth": true },
                { "data": "capasidadpalletsunidad", "autoWidth": true },
                { "data": "palletsembarcados", "autoWidth": true },
                { "data": "porcentajeocupacionunidad", "autoWidth": true },
                { "data": "capasidadunidad", "autoWidth": true },
                { "data": "pesoinventario", "autoWidth": true },
                { "data": "porcentajepesounidad", "autoWidth": true },
                { "data": "evaluacionocupacionunidad", "autoWidth": true },
                { "data": "numerocajas", "autoWidth": true },
                { "data": "numeropiezas", "autoWidth": true },
                { "data": "fhrequeridaposicionamientoString", "autoWidth": true },
                { "data": "fhrealpsocicionamientoString", "autoWidth": true },
                { "data": "evaluacionposicionamiento", "autoWidth": true },
                { "data": "fhcitaString", "autoWidth": true },
                { "data": "fharriborealString", "autoWidth": true },
                { "data": "evaluacionentrega", "autoWidth": true },
                { "data": "maniobristasrequeridos", "autoWidth": true },
                { "data": "maniobristasatiempo", "autoWidth": true },
                { "data": "evaluacionmaniobras", "autoWidth": true },
                { "data": "FacturacionFleteString", "autoWidth": true },
                { "data": "FacturacionManiobrasString", "autoWidth": true },
                { "data": "observaciones", "autoWidth": true },
            ]
        });

        $('#remision').on('keyup', function () {
            table.columns(1).search(this.value).draw();
        });

        $('#destino').on('keyup', function () {
            table.columns(6).search(this.value).draw();
        });

        $('#ddlTipoRequerimiento').on('change', function () {
            table.columns(9).search(this.value).draw();
        });        
    });   

    $(function () {
        var ddlCustomers = $("#ddlTipoRequerimiento");
        ddlCustomers.empty().append('<option selected="selected" value="0" disabled = "disabled">Loading ...</option>');
        $.ajax({
            type: "POST",
            url: "/kpistrafico/ListaTipoRequerimiento",
            data: '{}',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (response) {
                ddlCustomers.empty().append('<option selected="selected" value="0">Seleccione una opcion...</option>');
                $.each(response, function () {
                    ddlCustomers.append($("<option></option>").val(this['Value']).html(this['Text']));
                });
            },
            failure: function (response) {
                alert(response.responseText);
            },
            error: function (response) {
                alert(response.responseText);
            }
        });
    });

</script>
